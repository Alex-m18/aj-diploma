!function(e){var t={};function a(r){if(t[r])return t[r].exports;var n=t[r]={i:r,l:!1,exports:{}};return e[r].call(n.exports,n,n.exports,a),n.l=!0,n.exports}a.m=e,a.c=t,a.d=function(e,t,r){a.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},a.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a.t=function(e,t){if(1&t&&(e=a(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(a.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)a.d(r,n,function(t){return e[t]}.bind(null,n));return r},a.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return a.d(t,"a",t),t},a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},a.p="",a(a.s=49)}([function(e,t,a){var r=a(1),n=a(2);"string"==typeof(n=n.__esModule?n.default:n)&&(n=[[e.i,n,""]]);var i={insert:"head",singleton:!1},s=(r(n,i),n.locals?n.locals:{});e.exports=s},function(e,t,a){"use strict";var r,n=function(){return void 0===r&&(r=Boolean(window&&document&&document.all&&!window.atob)),r},i=function(){var e={};return function(t){if(void 0===e[t]){var a=document.querySelector(t);if(window.HTMLIFrameElement&&a instanceof window.HTMLIFrameElement)try{a=a.contentDocument.head}catch(e){a=null}e[t]=a}return e[t]}}(),s=[];function o(e){for(var t=-1,a=0;a<s.length;a++)if(s[a].identifier===e){t=a;break}return t}function l(e,t){for(var a={},r=[],n=0;n<e.length;n++){var i=e[n],l=t.base?i[0]+t.base:i[0],c=a[l]||0,d="".concat(l," ").concat(c);a[l]=c+1;var h=o(d),u={css:i[1],media:i[2],sourceMap:i[3]};-1!==h?(s[h].references++,s[h].updater(u)):s.push({identifier:d,updater:g(u,t),references:1}),r.push(d)}return r}function c(e){var t=document.createElement("style"),r=e.attributes||{};if(void 0===r.nonce){var n=a.nc;n&&(r.nonce=n)}if(Object.keys(r).forEach((function(e){t.setAttribute(e,r[e])})),"function"==typeof e.insert)e.insert(t);else{var s=i(e.insert||"head");if(!s)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");s.appendChild(t)}return t}var d,h=(d=[],function(e,t){return d[e]=t,d.filter(Boolean).join("\n")});function u(e,t,a,r){var n=a?"":r.media?"@media ".concat(r.media," {").concat(r.css,"}"):r.css;if(e.styleSheet)e.styleSheet.cssText=h(t,n);else{var i=document.createTextNode(n),s=e.childNodes;s[t]&&e.removeChild(s[t]),s.length?e.insertBefore(i,s[t]):e.appendChild(i)}}function m(e,t,a){var r=a.css,n=a.media,i=a.sourceMap;if(n?e.setAttribute("media",n):e.removeAttribute("media"),i&&btoa&&(r+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(i))))," */")),e.styleSheet)e.styleSheet.cssText=r;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(r))}}var f=null,p=0;function g(e,t){var a,r,n;if(t.singleton){var i=p++;a=f||(f=c(t)),r=u.bind(null,a,i,!1),n=u.bind(null,a,i,!0)}else a=c(t),r=m.bind(null,a,t),n=function(){!function(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e)}(a)};return r(e),function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap)return;r(e=t)}else n()}}e.exports=function(e,t){(t=t||{}).singleton||"boolean"==typeof t.singleton||(t.singleton=n());var a=l(e=e||[],t);return function(e){if(e=e||[],"[object Array]"===Object.prototype.toString.call(e)){for(var r=0;r<a.length;r++){var n=o(a[r]);s[n].references--}for(var i=l(e,t),c=0;c<a.length;c++){var d=o(a[c]);0===s[d].references&&(s[d].updater(),s.splice(d,1))}a=i}}}},function(e,t,a){var r=a(3),n=a(4),i=a(5),s=a(6),o=a(7),l=a(8),c=a(9),d=a(10),h=a(11),u=a(12),m=a(13),f=a(14),p=a(15),g=a(16),b=a(17),v=a(18),C=a(19),w=a(20),S=a(21),y=a(22),k=a(23),x=a(24),E=a(25),L=a(26),P=a(27),T=a(28),M=a(29),G=a(30),R=a(31),z=a(32),A=a(33),I=a(34),N=a(35),O=a(36),$=a(37),j=a(38),U=a(39),D=a(40),B=a(41),F=a(42),_=a(43),q=a(44),H=a(45),W=a(46),Y=a(47),J=a(48);t=r(!1);var Q=n(i),K=n(s),V=n(o),X=n(l),Z=n(c),ee=n(d),te=n(h),ae=n(u),re=n(m),ne=n(f),ie=n(p),se=n(g),oe=n(b),le=n(v),ce=n(C),de=n(w),he=n(S),ue=n(y),me=n(k),fe=n(x),pe=n(E),ge=n(L),be=n(P),ve=n(T),Ce=n(M),we=n(G),Se=n(R),ye=n(z),ke=n(A),xe=n(I),Ee=n(N),Le=n(O),Pe=n($),Te=n(j),Me=n(U),Ge=n(D),Re=n(B),ze=n(F),Ae=n(_),Ie=n(q),Ne=n(H),Oe=n(W),$e=n(Y),je=n(J);t.push([e.i,":root {\n  --cell-size: 64px;\n}\n\nhtml, body {\n  height: 100%;\n  margin: 0;\n}\n\nbody {\n  background: #000;\n  font-size: 16px;\n}\n\n.btn {\n  display: inline-block;\n  font-weight: 400;\n  color: #212529;\n  background-color: #f8f9fa;\n  text-align: center;\n  vertical-align: middle;\n  padding: .375rem .75rem;\n  font-size: 1rem;\n  line-height: 1.5;\n  border-radius: .25rem;\n  transition: color .15s ease-in-out,background-color .15s ease-in-out,border-color .15s ease-in-out,box-shadow .15s ease-in-out;\n  border: none;\n}\n\n.controls {\n  text-align: center;\n  margin: 50px 0;\n}\n\n.board-container {\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  flex-wrap: wrap;\n}\n\n.board {\n  display: grid;\n  grid-template-columns: repeat(8, 1fr);\n  grid-column-gap: 2px;\n  grid-row-gap: 2px;\n}\n\n.cell {\n  position: relative;\n}\n\n.cell.selected::before {\n  content: '';\n  display: block;\n  border: 4px;\n  border-radius: 32px;\n  box-sizing: border-box;\n  width: var(--cell-size);\n  height: var(--cell-size);\n  opacity: 0.9;\n  position: absolute;\n}\n\n.cell.selected-yellow::before {\n  border-color: #ff0;\n  border-style: solid;\n}\n\n.cell.selected-green::before {\n  border-color: #0f0;\n  border-style: dashed;\n}\n\n.cell.selected-red::before {\n  border-color: #f00;\n  border-style: dashed;\n}\n\n.board.prairie {\n  --map-tile-top-left-url: url("+Q+");\n  --map-tile-top-url: url("+K+");\n  --map-tile-top-right-url: url("+V+");\n  --map-tile-bottom-left-url: url("+X+");\n  --map-tile-bottom-url: url("+Z+");\n  --map-tile-bottom-right-url: url("+ee+");\n  --map-tile-left-url: url("+te+");\n  --map-tile-right-url: url("+ae+");\n  --map-tile-center-url: url("+re+");\n}\n\n.board.desert {\n  --map-tile-top-left-url: url("+ne+");\n  --map-tile-top-url: url("+ie+");\n  --map-tile-top-right-url: url("+se+");\n  --map-tile-bottom-left-url: url("+oe+");\n  --map-tile-bottom-url: url("+le+");\n  --map-tile-bottom-right-url: url("+ce+");\n  --map-tile-left-url: url("+de+");\n  --map-tile-right-url: url("+he+");\n  --map-tile-center-url: url("+ue+");\n}\n\n.board.arctic {\n  --map-tile-top-left-url: url("+me+");\n  --map-tile-top-url: url("+fe+");\n  --map-tile-top-right-url: url("+pe+");\n  --map-tile-bottom-left-url: url("+ge+");\n  --map-tile-bottom-url: url("+be+");\n  --map-tile-bottom-right-url: url("+ve+");\n  --map-tile-left-url: url("+Ce+");\n  --map-tile-right-url: url("+we+");\n  --map-tile-center-url: url("+Se+");\n}\n\n.board.mountain {\n  --map-tile-top-left-url: url("+ye+");\n  --map-tile-top-url: url("+ke+");\n  --map-tile-top-right-url: url("+xe+");\n  --map-tile-bottom-left-url: url("+Ee+");\n  --map-tile-bottom-url: url("+Le+");\n  --map-tile-bottom-right-url: url("+Pe+");\n  --map-tile-left-url: url("+Te+");\n  --map-tile-right-url: url("+Me+");\n  --map-tile-center-url: url("+Ge+");\n}\n\n.map-tile {\n  width: var(--cell-size);\n  height: var(--cell-size);\n}\n\n.map-tile-top-left {\n  background: var(--map-tile-top-left-url);\n}\n\n.map-tile-top {\n  background: var(--map-tile-top-url);\n}\n\n.map-tile-top-right {\n  background: var(--map-tile-top-right-url);\n}\n\n.map-tile-bottom-left {\n  background: var(--map-tile-bottom-left-url);\n}\n\n.map-tile-bottom {\n  background: var(--map-tile-bottom-url);\n}\n\n.map-tile-bottom-right {\n  background: var(--map-tile-bottom-right-url);\n}\n\n.map-tile-left {\n  background: var(--map-tile-left-url);\n}\n\n.map-tile-right {\n  background: var(--map-tile-right-url);\n}\n\n.map-tile-center {\n  background: var(--map-tile-center-url);\n}\n\n.character {\n  width: var(--cell-size);\n  height: var(--cell-size);\n  position: absolute;\n  z-index: 99;\n}\n\n.character.generic {\n  background: url("+Re+");\n}\n\n.character.bowman {\n  background: url("+ze+");\n}\n\n.character.daemon {\n  background: url("+Ae+");\n}\n\n.character.magician {\n  background: url("+Ie+");\n}\n\n.character.swordsman {\n  background: url("+Ne+");\n}\n\n.character.undead {\n  background: url("+Oe+");\n}\n\n.character.vampire {\n  background: url("+$e+");\n}\n\n.character.zombie {\n  background: url("+je+");\n}\n\n.health-level {\n  top: 2px;\n  left: 7px;\n  position: absolute;\n  width: 50px;\n  height: 4px;\n  background: #000;\n}\n\n.health-level-indicator {\n  height: 4px;\n}\n\n.health-level-indicator-high {\n  background: #0f0;\n}\n\n.health-level-indicator-normal {\n  background: #ff0;\n}\n\n.health-level-indicator-critical {\n  background: #f00;\n}\n\n.damage {\n  position: absolute;\n  width: var(--cell-size);\n  text-align: center;\n  z-index: 999;\n  color: #f00;\n  font-weight: bold;\n  animation: 500ms fade ease-out;\n}\n\n@keyframes fade {\n  from {\n    opacity: 0;\n    top: calc(var(--cell-size) * 0.5);\n    font-size: 1rem;\n  }\n  to {\n    opacity: 1;\n    top: -20px;\n    font-size: 1.5rem;\n  }\n}\n",""]),e.exports=t},function(e,t,a){"use strict";e.exports=function(e){var t=[];return t.toString=function(){return this.map((function(t){var a=function(e,t){var a=e[1]||"",r=e[3];if(!r)return a;if(t&&"function"==typeof btoa){var n=(s=r,o=btoa(unescape(encodeURIComponent(JSON.stringify(s)))),l="sourceMappingURL=data:application/json;charset=utf-8;base64,".concat(o),"/*# ".concat(l," */")),i=r.sources.map((function(e){return"/*# sourceURL=".concat(r.sourceRoot||"").concat(e," */")}));return[a].concat(i).concat([n]).join("\n")}var s,o,l;return[a].join("\n")}(t,e);return t[2]?"@media ".concat(t[2]," {").concat(a,"}"):a})).join("")},t.i=function(e,a,r){"string"==typeof e&&(e=[[null,e,""]]);var n={};if(r)for(var i=0;i<this.length;i++){var s=this[i][0];null!=s&&(n[s]=!0)}for(var o=0;o<e.length;o++){var l=[].concat(e[o]);r&&n[l[0]]||(a&&(l[2]?l[2]="".concat(a," and ").concat(l[2]):l[2]=a),t.push(l))}},t}},function(e,t,a){"use strict";e.exports=function(e,t){return t||(t={}),"string"!=typeof(e=e&&e.__esModule?e.default:e)?e:(/^['"].*['"]$/.test(e)&&(e=e.slice(1,-1)),t.hash&&(e+=t.hash),/["'() \t\n]/.test(e)||t.needQuotes?'"'.concat(e.replace(/"/g,'\\"').replace(/\n/g,"\\n"),'"'):e)}},function(e,t,a){"use strict";a.r(t),t.default=a.p+"8b88329c33dba4faf42c7db49fe2a509.png"},function(e,t,a){"use strict";a.r(t),t.default=a.p+"5f57874e43f12fffda467fc94116a049.png"},function(e,t,a){"use strict";a.r(t),t.default=a.p+"caea269d39950b02486940475d78db2e.png"},function(e,t,a){"use strict";a.r(t),t.default=a.p+"87372ea9616a8edba586f42970c5ef8b.png"},function(e,t,a){"use strict";a.r(t),t.default=a.p+"31ad2c93c8f6cc84ef581b5de6849313.png"},function(e,t,a){"use strict";a.r(t),t.default=a.p+"029ee51facbfc8a67f6adf424059eac4.png"},function(e,t,a){"use strict";a.r(t),t.default=a.p+"648cb1dfd9a0b21ee19a3c4efb6d2841.png"},function(e,t,a){"use strict";a.r(t),t.default=a.p+"668f7492bdec26da926f0391a6f188d5.png"},function(e,t,a){"use strict";a.r(t),t.default=a.p+"cc657ec84e39b3415392f8088b704dbf.png"},function(e,t,a){"use strict";a.r(t),t.default=a.p+"e4bb82fc350a47cd8d063dff5486ad16.png"},function(e,t,a){"use strict";a.r(t),t.default=a.p+"58a43fae0d0f7deed4f58b2c8af5197f.png"},function(e,t,a){"use strict";a.r(t),t.default=a.p+"ad09956ea38f698d2228241406d5c619.png"},function(e,t,a){"use strict";a.r(t),t.default=a.p+"500b00a472496581b61c7b3f050228b9.png"},function(e,t,a){"use strict";a.r(t),t.default=a.p+"e58a541e928b85192a72f859df20353d.png"},function(e,t,a){"use strict";a.r(t),t.default=a.p+"8f709cffba9a0dba6e245a59906195bb.png"},function(e,t,a){"use strict";a.r(t),t.default=a.p+"b48dcfbedbcfaeed76a58a6c2326f5b5.png"},function(e,t,a){"use strict";a.r(t),t.default=a.p+"8a4eb60c50566e3a55b8a69b743a1495.png"},function(e,t,a){"use strict";a.r(t),t.default=a.p+"489316d6dd3a667b0ec70f2967eda900.png"},function(e,t,a){"use strict";a.r(t),t.default=a.p+"9c8b9b5dc8ca9f2a244602cc3b2d3096.png"},function(e,t,a){"use strict";a.r(t),t.default=a.p+"54683de6e23a6fdcd697a3f79a7f8198.png"},function(e,t,a){"use strict";a.r(t),t.default=a.p+"77ce902e513588459beb186a36611f25.png"},function(e,t,a){"use strict";a.r(t),t.default=a.p+"97bbfe418bb50013cdc910294ab9cbe5.png"},function(e,t,a){"use strict";a.r(t),t.default=a.p+"204557a8e0609ff17bd63f9a08505d5e.png"},function(e,t,a){"use strict";a.r(t),t.default=a.p+"c98ac5b3fa5dc40db7bc7a44d9c994af.png"},function(e,t,a){"use strict";a.r(t),t.default=a.p+"b952c69a4f0f29541770a83db6131b33.png"},function(e,t,a){"use strict";a.r(t),t.default=a.p+"97ea9703ecf76d3be0c016d6e6e526c7.png"},function(e,t,a){"use strict";a.r(t),t.default=a.p+"4c763a2addae8299d67b3c0617ad787e.png"},function(e,t,a){"use strict";a.r(t),t.default=a.p+"80a5d0b947d35e167ad6bbf560e5b21a.png"},function(e,t,a){"use strict";a.r(t),t.default=a.p+"5cc6716feb9da37e536e269ef7a4f1d6.png"},function(e,t,a){"use strict";a.r(t),t.default=a.p+"47487165610b6ac8fc68098e8c02c50a.png"},function(e,t,a){"use strict";a.r(t),t.default=a.p+"6980ce7b28ddccd6e1ea16b0b74a5d54.png"},function(e,t,a){"use strict";a.r(t),t.default=a.p+"7acb75939d3b87572d01aa7952413f27.png"},function(e,t,a){"use strict";a.r(t),t.default=a.p+"4f65b5f1f530843b6d86bb918f23df26.png"},function(e,t,a){"use strict";a.r(t),t.default=a.p+"9c10a2462a67b8c84a8152d2e77e2c4a.png"},function(e,t,a){"use strict";a.r(t),t.default=a.p+"de3b89c2edd67045607d081ad726c9d3.png"},function(e,t,a){"use strict";a.r(t),t.default=a.p+"99f3aae6daf6ae69cf54dece74d39d89.png"},function(e,t,a){"use strict";a.r(t),t.default=a.p+"0f5d3f5bfcaf4965cc0a170e6e479aa7.png"},function(e,t,a){"use strict";a.r(t),t.default=a.p+"817d11bba3b3811d769ad627636349ad.png"},function(e,t,a){"use strict";a.r(t),t.default=a.p+"c393200b8b85b1daa174111f386c212f.png"},function(e,t,a){"use strict";a.r(t),t.default=a.p+"cc0123bb7e92111714143c3026f420fb.png"},function(e,t,a){"use strict";a.r(t),t.default=a.p+"ff13fb8ff2d1ddb742a40d3a75187c0e.png"},function(e,t,a){"use strict";a.r(t),t.default=a.p+"93609441a80af34c98563a7797ac8610.png"},function(e,t,a){"use strict";a.r(t),t.default=a.p+"2f218dc52fb1968dab2f6df24998abb9.png"},function(e,t,a){"use strict";a.r(t),t.default=a.p+"14ae8b1b0c430c4e0040e86919589975.png"},function(e,t,a){"use strict";a.r(t);a(0);class r{constructor(){this.boardSize=8,this.container=null,this.boardEl=null,this.cells=[],this.cellClickListeners=[],this.cellEnterListeners=[],this.cellLeaveListeners=[],this.newGameListeners=[],this.saveGameListeners=[],this.loadGameListeners=[]}bindToDOM(e){if(!(e instanceof HTMLElement))throw new Error("container is not HTMLElement");this.container=e}drawUi(e){this.checkBinding(),this.container.innerHTML='\n      <div class="controls">\n        <button data-id="action-restart" class="btn">New Game</button>\n        <button data-id="action-save" class="btn">Save Game</button>\n        <button data-id="action-load" class="btn">Load Game</button>\n      </div>\n      <div class="board-container">\n        <div data-id="board" class="board"></div>\n      </div>\n    ',this.newGameEl=this.container.querySelector("[data-id=action-restart]"),this.saveGameEl=this.container.querySelector("[data-id=action-save]"),this.loadGameEl=this.container.querySelector("[data-id=action-load]"),this.newGameEl.addEventListener("click",e=>this.onNewGameClick(e)),this.saveGameEl.addEventListener("click",e=>this.onSaveGameClick(e)),this.loadGameEl.addEventListener("click",e=>this.onLoadGameClick(e)),this.boardEl=this.container.querySelector("[data-id=board]"),this.boardEl.classList.add(e);for(let e=0;e<this.boardSize**2;e+=1){const r=document.createElement("div");r.classList.add("cell","map-tile",`map-tile-${t=e,a=this.boardSize,0===t?"top-left":t<a-1?"top":t===a-1?"top-right":t===a**2-1?"bottom-right":t>a**2-a?"bottom":t===a**2-a?"bottom-left":t%a==0?"left":t%a==a-1?"right":"center"}`),r.addEventListener("mouseenter",e=>this.onCellEnter(e)),r.addEventListener("mouseleave",e=>this.onCellLeave(e)),r.addEventListener("click",e=>this.onCellClick(e)),this.boardEl.appendChild(r)}var t,a;this.cells=Array.from(this.boardEl.children)}redrawPositions(e){for(const e of this.cells)e.innerHTML="";for(const a of e){const e=this.boardEl.children[a.position],r=document.createElement("div");r.classList.add("character",a.character.type);const n=document.createElement("div");n.classList.add("health-level");const i=document.createElement("div");i.classList.add("health-level-indicator",`health-level-indicator-${t=a.character.health,t<15?"critical":t<50?"normal":"high"}`),i.style.width=`${a.character.health}%`,n.appendChild(i),r.appendChild(n),e.appendChild(r)}var t}addCellEnterListener(e){this.cellEnterListeners.push(e)}addCellLeaveListener(e){this.cellLeaveListeners.push(e)}addCellClickListener(e){this.cellClickListeners.push(e)}addNewGameListener(e){this.newGameListeners.push(e)}addSaveGameListener(e){this.saveGameListeners.push(e)}addLoadGameListener(e){this.loadGameListeners.push(e)}onCellEnter(e){e.preventDefault();const t=this.cells.indexOf(e.currentTarget);this.cellEnterListeners.forEach(e=>e.call(null,t))}onCellLeave(e){e.preventDefault();const t=this.cells.indexOf(e.currentTarget);this.cellLeaveListeners.forEach(e=>e.call(null,t))}onCellClick(e){const t=this.cells.indexOf(e.currentTarget);this.cellClickListeners.forEach(e=>e.call(null,t))}onNewGameClick(e){e.preventDefault(),this.newGameListeners.forEach(e=>e.call(null))}onSaveGameClick(e){e.preventDefault(),this.saveGameListeners.forEach(e=>e.call(null))}onLoadGameClick(e){e.preventDefault(),this.loadGameListeners.forEach(e=>e.call(null))}static showError(e){alert(e)}static showMessage(e){alert(e)}selectCell(e,t="yellow"){this.deselectCell(e),this.cells[e].classList.add("selected",`selected-${t}`)}deselectCell(e){const t=this.cells[e];t.classList.remove(...Array.from(t.classList).filter(e=>e.startsWith("selected")))}showCellTooltip(e,t){this.cells[t].title=e}hideCellTooltip(e){this.cells[e].title=""}showDamage(e,t){return new Promise(a=>{const r=this.cells[e],n=document.createElement("span");n.textContent=t,n.classList.add("damage"),r.appendChild(n),n.addEventListener("animationend",()=>{r.removeChild(n),a()})})}setCursor(e){this.boardEl.style.cursor=e}checkBinding(){if(null===this.container)throw new Error("GamePlay not bind to DOM")}}var n={prairie:"prairie",desert:"desert",arctic:"arctic",mountain:"mountain"};var i=class{constructor(){this.members=new Set}add(e){this.members.add(e)}addAll(...e){for(const t of e)this.members.add(t)}toArray(){return[...this.members]}*[Symbol.iterator](){for(const e of this.members)yield e;return 0}get size(){return this.members.size}has(e){return this.members.has(e)}delete(e){return this.members.delete(e)}};function*s(e,t){for(;;){const a=new(e[Math.round(Math.random()*(e.length-1))]);a.level=Math.round(Math.random()*(t-1))+1,yield a}}function o(e,t,a){const r=new i,n=s(e,t);for(;r.size<a;)r.add(n.next().value);return r}class l{constructor(e,t="generic"){if("Character"===new.target.name)throw new Error('Using "new Character()" not allowed');if(!e&&"generic"===t)throw new Error('Using "new Character()" not allowed');this.private={type:t,level:e,attack:0,defence:0,health:100,attackRadius:1,moveRadius:1}}get type(){return this.private.type}get level(){return this.private.level}set level(e){if(this.level>e)throw new Error("Can't decrease level");for(;this.level<e;)this.levelUp()}get attack(){return this.private.attack}get health(){return this.private.powerModeAttacks?2*this.private.health:this.private.health}get defence(){return this.private.powerModeAttacks?2*this.private.defence:this.private.defence}damage(e){this.private.health-=e,this.health<0&&(this.private.health=0)}damageFromCharacter(e){const t=Math.max(e.attack-this.defence,.1*e.attack);return this.damage(t),t}levelUp(){if(0===this.health)throw new Error("Can't level up dead character");this.private.level+=1,this.private.attack=Math.max(this.attack,this.attack*(.8+this.health/100)),this.private.defence=Math.max(this.defence,this.defence*(.8+this.health/100)),this.private.health+=80,this.private.health>100&&(this.private.health=100)}}var c=class extends l{constructor(e=1){super(1,"bowman"),this.private.attack=25,this.private.defence=25,this.attackRadius=2,this.moveRadius=2,this.level=e}};var d=class extends l{constructor(e=1){super(1,"swordsman"),this.private.attack=40,this.private.defence=10,this.attackRadius=1,this.moveRadius=4,this.level=e}};var h=class extends l{constructor(e=1){super(1,"magician"),this.private.attack=10,this.private.defence=40,this.attackRadius=4,this.moveRadius=1,this.level=e}};var u=class extends l{constructor(e=1){super(1,"undead"),this.private.attack=25,this.private.defence=25,this.attackRadius=1,this.moveRadius=4,this.level=e}};var m=class extends l{constructor(e=1){super(1,"vampire"),this.private.attack=40,this.private.defence=10,this.attackRadius=2,this.moveRadius=2,this.level=e}};var f=class extends l{constructor(e=1){super(1,"daemon"),this.private.attack=10,this.private.defence=40,this.attackRadius=4,this.moveRadius=1,this.level=e}};class p{constructor(e,t){if(!(e instanceof l))throw new Error("character must be instance of Character or its children");if("number"!=typeof t)throw new Error("position must be a number");this.character=e,this.position=t}}class g{constructor(){this.board=new Map,this.level=1,this.userStep=!0,this.selectedCharacterIndex=-1,this.points=0}static from(e){const t=new g;if(e.level&&(t.level=e.level),e.userStep&&(t.userStep=e.userStep),e.selectedCharacterIndex&&(t.selectedCharacterIndex=e.selectedCharacterIndex),e.points&&(t.points=e.points),e.boardEntries)for(const a of e.boardEntries){let e;switch(a[1].character.private.type){case"bowman":e=c;break;case"swordsman":e=d;break;case"magician":e=h;break;case"undead":e=u;break;case"vampire":e=m;break;case"daemon":e=f;break;default:throw new Error("Wrong character type")}const r=new e;r.private.attack=a[1].character.private.attack,r.private.defence=a[1].character.private.defence,r.private.health=a[1].character.private.health,r.private.attackRadius=a[1].character.private.attackRadius,r.private.moveRadius=a[1].character.private.moveRadius,r.private.level=a[1].character.private.level,t.board.set(a[0],new p(r,a[1].position))}return t}}var b={auto:"auto",pointer:"pointer",crosshair:"crosshair",notallowed:"not-allowed"};class v extends class{constructor(e){if("Strategy"===new.target.name)throw new Error('Using "new Strategy()" not allowed');this.gameController=e}nextStep(){this.gameController.nextStep()}}{async nextStep(){const e=this.getBotsWhoCanAttack();if(e.length){const t=e[Math.round(Math.random()*(e.length-1))],a=this.gameController.getPositionedCharacter(t.bot).position;return this.gameController.onCellClick(a,!0),void await this.gameController.onCellClick(t.cells[Math.round(Math.random()*(t.cells.length-1))],!0)}const t=this.gameController.currentTeam.toArray(),a=t[Math.round(Math.random()*(t.length-1))],r=this.gameController.getPositionedCharacter(a).position;this.gameController.onCellClick(r,!0);const n=this.getAvailableCellsToMove(a);await this.gameController.onCellClick(n[Math.round(Math.random()*(n.length-1))],!0)}getBotsWhoCanAttack(){const e=[],t=this.gameController.currentTeam.toArray();for(const a of t){const t=this.getAvailableCellsToAttack(a);t.length>0&&e.push({bot:a,cells:t})}return e}getAvailableCellsToAttack(e){const t=[];for(let a=0;a<this.gameController.gamePlay.boardSize**2;a+=1)this.gameController.canAttack(e,a)&&t.push(a);return t}getAvailableCellsToMove(e){const t=[];for(let a=0;a<this.gameController.gamePlay.boardSize**2;a+=1)this.gameController.canMove(e,a)&&t.push(a);return t}}const C=new r;C.bindToDOM(document.querySelector("#game-container")),new class{constructor(e,t){this.gamePlay=e,this.stateService=t,this.stepEnabled=!0}init(){this.gamePlay.addCellEnterListener(this.onCellEnter.bind(this)),this.gamePlay.addCellLeaveListener(this.onCellLeave.bind(this)),this.gamePlay.addCellClickListener(this.onCellClick.bind(this)),this.gamePlay.addNewGameListener(this.newGame.bind(this)),this.gamePlay.addSaveGameListener(this.saveGame.bind(this)),this.gamePlay.addLoadGameListener(this.loadGame.bind(this)),this.loadGame()}newGame(){this.gameState=new g,this.nextLevel()}saveGame(){this.gameState.boardEntries=[...this.gameState.board.entries()],this.stateService.save(this.gameState),delete this.gameState.boardEntries,r.showMessage("Game saved")}loadGame(){let e;try{if(e=g.from(this.stateService.load()),!e.board.size)throw new Error("Load error")}catch(e){return this.gameState||this.newGame(),void r.showError("Nothing to load")}this.gameState=e,this.userTeam=new i,this.botTeam=new i;for(const e of this.gameState.board.values())switch(e.character.type){default:case"bowman":case"swordsman":case"magician":this.userTeam.add(e.character);break;case"daemon":case"undead":case"vampire":this.botTeam.add(e.character)}this.drawBoard(this.gameState.level),this.gamePlay.redrawPositions(this.gameState.board.values()),this.isCharacterSelected&&this.selectCharacter(this.selectedCharacterIndex)}onCellEnter(e){if(this.gameState.userStep){if(this.isCharacterExistsInCell(e)){const{character:t}=this.gameState.board.get(e);this.gamePlay.showCellTooltip(function(e){return`${String.fromCodePoint(127894)}${e.level}\n${String.fromCodePoint(9876)}${Number(e.attack.toFixed(1))}\n${String.fromCodePoint(128737)}${Number(e.defence.toFixed(1))}\n${String.fromCodePoint(10084)}${Number(e.health.toFixed(1))}`}(t),e)}(()=>{if(this.isCharacterSelected)return this.gameState.board.has(e)&&this.currentTeam.has(this.gameState.board.get(e).character)?void this.gamePlay.setCursor(b.pointer):this.canMove(this.selectedCharacter,e)?(this.gamePlay.setCursor(b.pointer),void this.gamePlay.selectCell(e,"green")):this.canAttack(this.selectedCharacter,e)?(this.gamePlay.setCursor(b.crosshair),void this.gamePlay.selectCell(e,"red")):void this.gamePlay.setCursor(b.notallowed);this.gameState.board.has(e)&&this.currentTeam.has(this.gameState.board.get(e).character)?this.gamePlay.setCursor(b.pointer):this.gamePlay.setCursor(b.notallowed)})()}}onCellLeave(e){this.gamePlay.hideCellTooltip(e),this.isCharacterSelected&&e!==this.gameState.selectedCharacterIndex&&this.gamePlay.deselectCell(e),this.gamePlay.setCursor(b.auto)}async onCellClick(e,t=!1){if(this.gameState.userStep||t){if(this.isCharacterSelected){if(this.canMove(this.selectedCharacter,e))return this.stepEnabled=!1,this.gameState.board.set(e,this.gameState.board.get(this.gameState.selectedCharacterIndex)),this.gameState.board.get(e).position=e,this.gameState.board.delete(this.gameState.selectedCharacterIndex),this.deselectAllCells(),this.gamePlay.redrawPositions(this.gameState.board.values()),void this.nextStep();if(this.canAttack(this.selectedCharacter,e)){this.stepEnabled=!1;const t=this.selectedCharacter,a=this.gameState.board.get(e).character,n=Number(a.damageFromCharacter(t).toFixed(1));return void this.gamePlay.showDamage(e,n).then(()=>{if(0===a.health&&(this.gameState.board.delete(e),this.anotherTeam.delete(a),this.deselectAllCells(),0===this.anotherTeam.size))return this.gameState.userStep?(this.gameState.points=Number(this.calcPoints().toFixed(1)),r.showMessage(`Level ${this.gameState.level} complete!\nYour score - ${this.gameState.points}!\nLast record - ${this.record}`),this.nextLevel(this.gameState.level+=1),void(this.stepEnabled=!0)):(r.showMessage("You lose!"),this.gamePlay.redrawPositions(this.gameState.board.values()),void(this.stepEnabled=!0));this.gamePlay.redrawPositions(this.gameState.board.values()),this.nextStep()})}}if(this.deselectAllCells(),this.isCharacterExistsInCell(e)){const{character:t}=this.gameState.board.get(e);if(this.currentTeam.has(t))return void this.selectCharacter(e);r.showError("You can't select this character")}}}nextStep(){if(this.stepEnabled=!0,this.deselectAllCells(),this.gameState.userStep=!this.gameState.userStep,!this.gameState.userStep){new v(this).nextStep()}}drawBoard(e){let t;switch(e){default:case 1:t=n.prairie;break;case 2:t=n.desert;break;case 3:t=n.arctic;break;case 4:t=n.mountain}this.gamePlay.drawUi(t)}nextLevel(e=1){const t=(e=!0)=>{const t=e?0:this.gamePlay.boardSize-2;return Math.round(Math.random()*(this.gamePlay.boardSize-1))*this.gamePlay.boardSize+t+Math.round(Math.random())},a=(e,a)=>{for(const r of e){let e=t(a);for(;this.gameState.board.has(e);)e=t(a);this.gameState.board.set(e,new p(r,e))}};switch(this.gameState.board=new Map,this.drawBoard(e),this.record<this.gameState.points&&(this.record=this.gameState.points),e){case 1:this.userTeam=o([c,d],1,2),this.botTeam=o([u,m,f],1,2);break;case 2:this.userTeam.toArray().forEach(e=>e.levelUp()),this.userTeam.add(s([c,d,h],1).next().value),this.botTeam=o([u,m,f],2,this.userTeam.size);break;case 3:this.userTeam.toArray().forEach(e=>e.levelUp()),this.userTeam.add(s([c,d,h],2).next().value),this.userTeam.add(s([c,d,h],2).next().value),this.botTeam=o([u,m,f],3,this.userTeam.size);break;case 4:this.gamePlay.drawUi(n.mountain),this.userTeam.toArray().forEach(e=>e.levelUp()),this.userTeam.add(s([c,d,h],3).next().value),this.userTeam.add(s([c,d,h],3).next().value),this.botTeam=o([u,m,f],4,this.userTeam.size);break;default:return void r.showMessage(`You win!\nYour score - ${Number(this.calcPoints().toFixed(1))}!\n${this.record===this.gameState.points?"NEW RECORD":"Last record"} - ${this.record}`)}this.deselectAllCells(),this.gameState.userStep=!0,a(this.userTeam,!0),a(this.botTeam,!1),this.gamePlay.redrawPositions(this.gameState.board.values())}calcPoints(){let e=0;for(const t of this.userTeam)e+=t.health;return e}deselectAllCells(){for(let e=0;e<this.gamePlay.boardSize**2;e+=1)this.gamePlay.deselectCell(e);this.gameState.selectedCharacterIndex=-1}isCharacterExistsInCell(e){return this.gameState.board.has(e)}get record(){return this.stateService.loadRecord()||0}set record(e){this.stateService.saveRecord(e)}get currentTeam(){return this.gameState.userStep?this.userTeam:this.botTeam}get anotherTeam(){return this.gameState.userStep?this.botTeam:this.userTeam}selectCharacter(e){return this.gamePlay.selectCell(e),this.gameState.selectedCharacterIndex=e,this.selectedCharacter}get isCharacterSelected(){return-1!==this.gameState.selectedCharacterIndex}get selectedCharacter(){return this.isCharacterSelected?this.gameState.board.get(this.gameState.selectedCharacterIndex).character:null}get selectedCharacterIndex(){return this.gameState.selectedCharacterIndex}getRow(e){return function(e,t){return Math.floor(e/t)}(e,this.gamePlay.boardSize)}getColumn(e){return function(e,t){return e%t}(e,this.gamePlay.boardSize)}getPositionedCharacter(e){for(const t of this.gameState.board.values())if(t.character===e)return t;return null}canMove(e,t){if(!this.stepEnabled)return!1;const a=this.getRow(t),r=this.getColumn(t),n="PositionedCharacter"!==e.constructor.name?this.getPositionedCharacter(e):e,i=this.getRow(n.position),s=this.getColumn(n.position);return(a===i||r===s||Math.abs(a-i)===Math.abs(r-s))&&Math.abs(a-i)<=n.character.moveRadius&&Math.abs(r-s)<=n.character.moveRadius&&!this.isCharacterExistsInCell(t)}canAttack(e,t){if(!this.stepEnabled)return!1;const a=this.getRow(t),r=this.getColumn(t),n="PositionedCharacter"!==e.constructor.name?this.getPositionedCharacter(e):e,i=this.getRow(n.position),s=this.getColumn(n.position);return Math.abs(a-i)<=n.character.attackRadius&&Math.abs(r-s)<=n.character.attackRadius&&this.gameState.board.has(t)&&this.anotherTeam.has(this.gameState.board.get(t).character)}}(C,new class{constructor(e){this.storage=e}save(e){this.storage.setItem("state",JSON.stringify(e))}saveRecord(e){this.storage.setItem("record",e)}loadRecord(){return this.storage.getItem("record")}load(){try{return JSON.parse(this.storage.getItem("state"))}catch(e){throw new Error("Invalid state")}}}(localStorage)).init()}]);